<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Game H·ªçc T·ª´ V·ª±ng Ti·∫øng Anh</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-attachment: fixed;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            color: white;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 25px;
            border-radius: 50px;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-item span {
            font-size: 1.3rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            justify-content: center;
        }

        .tab-btn {
            padding: 15px 35px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .tab-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .tab-btn.active {
            background: white;
            color: #764ba2;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        /* Sections */
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Card */
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 35px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
            margin-bottom: 25px;
        }

        .card h2 {
            color: #764ba2;
            margin-bottom: 25px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Input Section */
        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 20px;
        }

        input[type="text"] {
            padding: 18px 25px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 4px rgba(118, 75, 162, 0.1);
        }

        .btn {
            padding: 18px 35px;
            border: none;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(118, 75, 162, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(17, 153, 142, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #eb3349, #f45c43);
            color: white;
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-danger:hover {
            transform: scale(1.05);
        }

        /* Word List */
        .word-list {
            display: grid;
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .word-list::-webkit-scrollbar {
            width: 8px;
        }

        .word-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .word-list::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        .word-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 25px;
            background: linear-gradient(135deg, #f8f9ff, #f0f2ff);
            border-radius: 15px;
            border-left: 5px solid #764ba2;
            transition: all 0.3s ease;
        }

        .word-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .word-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .english-word {
            font-weight: 700;
            color: #764ba2;
            font-size: 1.1rem;
        }

        .meaning {
            color: #666;
        }

        .speak-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .speak-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
        }

        /* Game Section */
        .game-area {
            text-align: center;
        }

        .game-question {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 40px;
            border-radius: 25px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .game-question::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: shine 3s infinite linear;
        }

        @keyframes shine {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .question-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .question-word {
            font-size: 3rem;
            font-weight: 800;
            color: white;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }

        .question-speak-btn {
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.4);
            padding: 12px 30px;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .question-speak-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .answers-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .answer-btn {
            padding: 25px 20px;
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            color: #333;
        }

        .answer-btn:hover {
            border-color: #764ba2;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .answer-btn.correct {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            border-color: #11998e;
            color: white;
            animation: pulse 0.5s ease;
        }

        .answer-btn.wrong {
            background: linear-gradient(135deg, #eb3349, #f45c43);
            border-color: #eb3349;
            color: white;
            animation: shake 0.5s ease;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }
        }

        /* Game Modes */
        .game-modes {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-card {
            background: linear-gradient(135deg, #f8f9ff, #f0f2ff);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border-color: #764ba2;
        }

        .mode-card.selected {
            border-color: #764ba2;
            background: linear-gradient(135deg, #ede7f6, #e1d5f7);
        }

        .mode-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .mode-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #764ba2;
            margin-bottom: 8px;
        }

        .mode-desc {
            color: #666;
            font-size: 0.9rem;
        }

        /* Progress */
        .progress-bar {
            background: #e0e0e0;
            height: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #11998e, #38ef7d);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Result */
        .result-card {
            text-align: center;
            padding: 50px;
        }

        .result-emoji {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .result-title {
            font-size: 2rem;
            font-weight: 800;
            color: #764ba2;
            margin-bottom: 15px;
        }

        .result-score {
            font-size: 4rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        .result-message {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 30px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .input-group {
                grid-template-columns: 1fr;
            }

            .game-modes {
                grid-template-columns: 1fr;
            }

            .answers-grid {
                grid-template-columns: 1fr;
            }

            .question-word {
                font-size: 2rem;
            }

            .stats-bar {
                gap: 10px;
            }

            .stat-item {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .empty-state p {
            font-size: 1.1rem;
        }

        /* Sample Words Button */
        .sample-words-btn {
            margin-top: 15px;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .sample-words-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(240, 147, 251, 0.4);
        }

        /* Typing Mode Styles */
        .typing-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .typing-input {
            flex: 1;
            padding: 20px 25px;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1.3rem;
            font-family: inherit;
            text-align: center;
            transition: all 0.3s ease;
        }

        .typing-input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 4px rgba(118, 75, 162, 0.15);
        }

        .typing-input.correct {
            border-color: #11998e;
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
        }

        .typing-input.wrong {
            border-color: #eb3349;
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            animation: shake 0.5s ease;
        }

        .typing-feedback {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            min-height: 30px;
            margin-bottom: 15px;
        }

        .typing-feedback.correct {
            color: #11998e;
        }

        .typing-feedback.wrong {
            color: #eb3349;
        }

        .typing-hint {
            text-align: center;
            color: #999;
            font-size: 1rem;
        }

        .hint-btn {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-family: inherit;
            color: #e65100;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .hint-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(252, 182, 159, 0.5);
        }

        .hint-text {
            background: linear-gradient(135deg, #fff9c4, #fff59d);
            padding: 15px 25px;
            border-radius: 15px;
            margin-top: 15px;
            font-size: 1.1rem;
            color: #f57f17;
            font-weight: 600;
            display: inline-block;
        }

        /* Game modes grid for 3 items */
        .game-modes {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .game-modes {
                grid-template-columns: 1fr;
            }

            .typing-container {
                flex-direction: column;
            }

            .typing-input {
                font-size: 1.1rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div
                style="background: linear-gradient(135deg, #ffd700, #ff8c00); padding: 12px 25px; border-radius: 50px; display: inline-block; margin-bottom: 15px; box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);">
                <p
                    style="font-size: 1.1rem; color: #1a1a2e; margin: 0; font-weight: 800; letter-spacing: 1px; text-transform: uppercase;">
                    üè´ H·ªá th·ªëng l·ªõp h·ªçc theo y√™u c·∫ßu EEC - 0829120482</p>
            </div>
            <h1>üéÆ Game H·ªçc T·ª´ V·ª±ng</h1>
            <p>H·ªçc t·ª´ m·ªõi ti·∫øng Anh m·ªôt c√°ch vui v·∫ª v√† hi·ªáu qu·∫£!</p>
            <div class="stats-bar">
                <div class="stat-item">
                    <span>üìö</span>
                    <span id="totalWords">0</span> t·ª´
                </div>
                <div class="stat-item">
                    <span>üéØ</span>
                    <span id="totalCorrect">0</span> ƒë√∫ng
                </div>
                <div class="stat-item">
                    <span>‚≠ê</span>
                    <span id="totalScore">0</span> ƒëi·ªÉm
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showSection('input')">üìù Nh·∫≠p T·ª´</button>
            <button class="tab-btn" onclick="showSection('game')">üéÆ Ch∆°i Game</button>
        </div>

        <!-- Input Section -->
        <div id="input-section" class="section active">
            <div class="card">
                <h2>üìù Th√™m T·ª´ M·ªõi</h2>
                <div class="input-group">
                    <input type="text" id="englishInput" placeholder="T·ª´ ti·∫øng Anh (VD: Hello)">
                    <input type="text" id="meaningInput" placeholder="Nghƒ©a ti·∫øng Vi·ªát (VD: Xin ch√†o)">
                    <button class="btn btn-primary" onclick="addWord()">‚ûï Th√™m</button>
                </div>
            </div>

            <div class="card">
                <h2>üìö Danh S√°ch T·ª´ V·ª±ng <span id="wordCount" style="font-size: 0.9rem; color: #999;"></span></h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn btn-danger" onclick="deleteAllWords()" style="padding: 12px 20px;">üóëÔ∏è X√≥a t·∫•t
                        c·∫£</button>
                    <button class="sample-words-btn" onclick="addSampleWords()" style="margin-top: 0;">‚ú® Th√™m t·ª´
                        m·∫´u</button>
                </div>
                <div id="wordList" class="word-list">
                    <div class="empty-state">
                        <div class="icon">üìñ</div>
                        <p>Ch∆∞a c√≥ t·ª´ n√†o. H√£y th√™m t·ª´ m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu h·ªçc!</p>
                        <button class="sample-words-btn" onclick="addSampleWords()">‚ú® Th√™m t·ª´ m·∫´u</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Section -->
        <div id="game-section" class="section">
            <div class="card">
                <h2>üéØ Ch·ªçn Ch·∫ø ƒê·ªô Ch∆°i</h2>
                <div class="game-modes">
                    <div class="mode-card selected" onclick="selectMode('meaning')" id="mode-meaning">
                        <div class="mode-icon">üî§</div>
                        <div class="mode-title">Ch·ªçn Nghƒ©a</div>
                        <div class="mode-desc">Xem t·ª´ ti·∫øng Anh, ch·ªçn nghƒ©a ƒë√∫ng</div>
                    </div>
                    <div class="mode-card" onclick="selectMode('word')" id="mode-word">
                        <div class="mode-icon">üá¨üáß</div>
                        <div class="mode-title">Ch·ªçn T·ª´</div>
                        <div class="mode-desc">Xem nghƒ©a ti·∫øng Vi·ªát, ch·ªçn t·ª´ ti·∫øng Anh ƒë√∫ng</div>
                    </div>
                    <div class="mode-card" onclick="selectMode('typing')" id="mode-typing">
                        <div class="mode-icon">‚å®Ô∏è</div>
                        <div class="mode-title">Vi·∫øt T·ª´</div>
                        <div class="mode-desc">Xem nghƒ©a ti·∫øng Vi·ªát, g√µ t·ª´ ti·∫øng Anh</div>
                    </div>
                </div>
                <button class="btn btn-success" onclick="startGame()" style="width: 100%;">üöÄ B·∫Øt ƒê·∫ßu Ch∆°i</button>
            </div>

            <!-- Game Play Area -->
            <div id="gamePlayArea" style="display: none;">
                <div class="card game-area">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                    </div>
                    <div class="game-question">
                        <div class="question-label" id="questionLabel">T·ª´ ti·∫øng Anh:</div>
                        <div class="question-word" id="questionWord">Hello</div>
                        <button class="question-speak-btn" onclick="speakCurrentWord()" id="speakBtn">üîä Nghe ph√°t
                            √¢m</button>
                    </div>
                    <!-- Multiple Choice Answers -->
                    <div class="answers-grid" id="answersGrid">
                        <!-- Answers will be generated here -->
                    </div>
                    <!-- Typing Input -->
                    <div id="typingArea" style="display: none;">
                        <div class="typing-container">
                            <input type="text" id="typingInput" class="typing-input"
                                placeholder="G√µ t·ª´ ti·∫øng Anh ·ªü ƒë√¢y..." autocomplete="off" autocapitalize="off">
                            <button class="btn btn-primary" onclick="checkTypingAnswer()" id="submitTypingBtn">‚úì Ki·ªÉm
                                tra</button>
                        </div>
                        <div id="typingFeedback" class="typing-feedback"></div>
                        <div id="typingHint" class="typing-hint"></div>
                    </div>
                </div>
            </div>

            <!-- Result -->
            <div id="resultArea" style="display: none;">
                <div class="card result-card">
                    <div class="result-emoji" id="resultEmoji">üéâ</div>
                    <h2 class="result-title" id="resultTitle">Xu·∫•t s·∫Øc!</h2>
                    <div class="result-score" id="resultScore">10/10</div>
                    <p class="result-message" id="resultMessage">B·∫°n ƒë√£ l√†m r·∫•t t·ªët!</p>
                    <button class="btn btn-primary" onclick="restartGame()">üîÑ Ch∆°i L·∫°i</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Audio Context for sound effects
        let audioContext = null;
        let audioUnlocked = false;

        // Initialize and get audio context
        function initAudio() {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                return audioContext;
            } catch (e) {
                console.log('Audio not supported:', e);
                return null;
            }
        }

        // Ensure audio context is ready to play
        async function ensureAudioReady() {
            const ctx = initAudio();
            if (!ctx) return null;

            try {
                if (ctx.state === 'suspended') {
                    await ctx.resume();
                }
                return ctx;
            } catch (e) {
                console.log('Could not resume audio:', e);
                return ctx;
            }
        }

        // Unlock audio on first user interaction (required for iOS/Android)
        async function unlockAudio() {
            if (audioUnlocked) return;

            try {
                const ctx = initAudio();
                if (!ctx) return;

                // Resume context first
                if (ctx.state === 'suspended') {
                    await ctx.resume();
                }

                // Create and play a silent buffer to unlock
                const buffer = ctx.createBuffer(1, 1, 22050);
                const source = ctx.createBufferSource();
                source.buffer = buffer;
                source.connect(ctx.destination);
                source.start(0);

                audioUnlocked = true;
                console.log('Audio unlocked for mobile, state:', ctx.state);
            } catch (e) {
                console.log('Audio unlock failed:', e);
            }
        }

        // Add unlock listeners for mobile - multiple events for better coverage
        ['touchstart', 'touchend', 'mousedown', 'click', 'keydown'].forEach(event => {
            document.addEventListener(event, unlockAudio, { once: false, passive: true });
        });

        // Safe sound player wrapper
        async function playSound(soundFn) {
            try {
                await ensureAudioReady();
                soundFn();
            } catch (e) {
                console.log('Sound play error:', e);
            }
        }

        // Sound: Correct answer (happy ding)
        function playCorrectSound() {
            playSound(() => {
                const ctx = initAudio();
                if (!ctx) return;

                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);

                const now = ctx.currentTime;
                oscillator.frequency.setValueAtTime(523.25, now);
                oscillator.frequency.setValueAtTime(659.25, now + 0.1);
                oscillator.frequency.setValueAtTime(783.99, now + 0.2);

                gainNode.gain.setValueAtTime(0.4, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);

                oscillator.type = 'sine';
                oscillator.start(now);
                oscillator.stop(now + 0.5);
            });
        }

        // Sound: Wrong answer (buzzer)
        function playWrongSound() {
            playSound(() => {
                const ctx = initAudio();
                if (!ctx) return;

                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);

                const now = ctx.currentTime;
                oscillator.frequency.setValueAtTime(150, now);
                oscillator.frequency.setValueAtTime(100, now + 0.1);

                gainNode.gain.setValueAtTime(0.4, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);

                oscillator.type = 'sawtooth';
                oscillator.start(now);
                oscillator.stop(now + 0.3);
            });
        }

        // Sound: Game complete fanfare
        function playCompletionSound() {
            playSound(() => {
                const ctx = initAudio();
                if (!ctx) return;
                const notes = [523.25, 659.25, 783.99, 1046.50];
                const now = ctx.currentTime;

                notes.forEach((freq, i) => {
                    const oscillator = ctx.createOscillator();
                    const gainNode = ctx.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(ctx.destination);
                    oscillator.frequency.setValueAtTime(freq, now + i * 0.15);
                    gainNode.gain.setValueAtTime(0, now + i * 0.15);
                    gainNode.gain.linearRampToValueAtTime(0.4, now + i * 0.15 + 0.05);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + i * 0.15 + 0.4);
                    oscillator.type = 'sine';
                    oscillator.start(now + i * 0.15);
                    oscillator.stop(now + i * 0.15 + 0.5);
                });
            });
        }

        // Sound: Perfect score celebration
        function playPerfectSound() {
            playSound(() => {
                const ctx = initAudio();
                if (!ctx) return;
                const melody = [
                    { freq: 523.25, time: 0 },
                    { freq: 587.33, time: 0.1 },
                    { freq: 659.25, time: 0.2 },
                    { freq: 698.46, time: 0.3 },
                    { freq: 783.99, time: 0.4 },
                    { freq: 880.00, time: 0.55 },
                    { freq: 987.77, time: 0.7 },
                    { freq: 1046.50, time: 0.85 },
                ];
                const now = ctx.currentTime;

                melody.forEach(note => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.frequency.setValueAtTime(note.freq, now + note.time);
                    gain.gain.setValueAtTime(0.3, now + note.time);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + note.time + 0.3);
                    osc.type = 'sine';
                    osc.start(now + note.time);
                    osc.stop(now + note.time + 0.35);
                });
            });
        }

        // Sound: Click/tap effect
        function playClickSound() {
            playSound(() => {
                const ctx = initAudio();
                if (!ctx) return;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                const now = ctx.currentTime;
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.setValueAtTime(800, now);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.type = 'sine';
                osc.start(now);
                osc.stop(now + 0.1);
            });
        }

        // Sound: Add word success
        function playAddSound() {
            playSound(() => {
                const ctx = initAudio();
                if (!ctx) return;
                const notes = [523.25, 783.99];
                const now = ctx.currentTime;
                notes.forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.frequency.setValueAtTime(freq, now + i * 0.08);
                    gain.gain.setValueAtTime(0.25, now + i * 0.08);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.08 + 0.15);
                    osc.type = 'sine';
                    osc.start(now + i * 0.08);
                    osc.stop(now + i * 0.08 + 0.2);
                });
            });
        }

        // Sound: Delete effect
        function playDeleteSound() {
            playSound(() => {
                const ctx = initAudio();
                if (!ctx) return;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                const now = ctx.currentTime;
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.2);
                gain.gain.setValueAtTime(0.25, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                osc.type = 'sine';
                osc.start(now);
                osc.stop(now + 0.25);
            });
        }

        // Sound: Delete all (whoosh)
        function playDeleteAllSound() {
            playSound(() => {
                const ctx = initAudio();
                if (!ctx) return;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                const now = ctx.currentTime;
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.exponentialRampToValueAtTime(50, now + 0.4);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
                osc.type = 'sawtooth';
                osc.start(now);
                osc.stop(now + 0.5);
            });
        }

        // Sound: Button hover/tap
        function playSpeakSound() {
            playSound(() => {
                const ctx = initAudio();
                if (!ctx) return;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                const now = ctx.currentTime;
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.setValueAtTime(1000, now);
                gain.gain.setValueAtTime(0.15, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
                osc.type = 'sine';
                osc.start(now);
                osc.stop(now + 0.08);
            });
        }

        // Data
        let words = JSON.parse(localStorage.getItem('vocabWords')) || [];
        let gameMode = 'meaning';
        let currentQuestionIndex = 0;
        let correctAnswers = 0;
        let gameWords = [];
        let totalScore = parseInt(localStorage.getItem('totalScore')) || 0;
        let totalCorrect = parseInt(localStorage.getItem('totalCorrect')) || 0;

        // Sample words
        const sampleWords = [
            { english: 'Hello', meaning: 'Xin ch√†o' },
            { english: 'Goodbye', meaning: 'T·∫°m bi·ªát' },
            { english: 'Thank you', meaning: 'C·∫£m ∆°n' },
            { english: 'Beautiful', meaning: 'ƒê·∫πp' },
            { english: 'Happy', meaning: 'Vui v·∫ª' },
            { english: 'Love', meaning: 'T√¨nh y√™u' },
            { english: 'Friend', meaning: 'B·∫°n b√®' },
            { english: 'Family', meaning: 'Gia ƒë√¨nh' },
            { english: 'School', meaning: 'Tr∆∞·ªùng h·ªçc' },
            { english: 'Book', meaning: 'S√°ch' }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateWordList();
            updateStats();

            // Enter key to add word
            document.getElementById('meaningInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addWord();
            });
            document.getElementById('englishInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') document.getElementById('meaningInput').focus();
            });

            // Enter key to submit typing answer
            document.getElementById('typingInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.target.disabled) {
                    checkTypingAnswer();
                }
            });
        });

        // Tab Navigation
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

            document.getElementById(section + '-section').classList.add('active');
            event.target.classList.add('active');

            if (section === 'game') {
                resetGameUI();
            }
        }

        // Add Word
        function addWord() {
            const english = document.getElementById('englishInput').value.trim();
            const meaning = document.getElementById('meaningInput').value.trim();

            if (!english || !meaning) {
                playWrongSound();
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t·ª´ ti·∫øng Anh v√† nghƒ©a!');
                return;
            }

            words.push({ english, meaning });
            saveWords();
            updateWordList();
            updateStats();
            playAddSound();

            document.getElementById('englishInput').value = '';
            document.getElementById('meaningInput').value = '';
            document.getElementById('englishInput').focus();
        }

        // Add Sample Words
        function addSampleWords() {
            words = [...words, ...sampleWords];
            saveWords();
            updateWordList();
            updateStats();
            playAddSound();
        }

        // Delete Word
        function deleteWord(index) {
            words.splice(index, 1);
            saveWords();
            updateWordList();
            updateStats();
            playDeleteSound();
        }

        // Delete All Words
        function deleteAllWords() {
            if (words.length === 0) {
                playWrongSound();
                return;
            }

            playClickSound();
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a T·∫§T C·∫¢ ' + words.length + ' t·ª´ kh√¥ng?')) {
                words = [];
                saveWords();
                updateWordList();
                updateStats();
                playDeleteAllSound();
            }
        }

        // Speech Synthesis for mobile (iOS + Android)
        let speechUnlocked = false;
        let voicesLoaded = false;
        let availableVoices = [];

        // Load voices when available
        function loadVoices() {
            availableVoices = speechSynthesis.getVoices();
            if (availableVoices.length > 0) {
                voicesLoaded = true;
                console.log('Voices loaded:', availableVoices.length);
            }
        }

        // Try to load voices - needed for both iOS and Android
        if ('speechSynthesis' in window) {
            loadVoices();
            // Chrome on Android needs this event
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
            // Fallback: try loading after a delay (for some Android browsers)
            setTimeout(loadVoices, 100);
            setTimeout(loadVoices, 500);
            setTimeout(loadVoices, 1000);
        }

        // Unlock speech on user interaction (required for iOS/Android)
        function unlockSpeech() {
            if (speechUnlocked || !('speechSynthesis' in window)) return;

            try {
                // Resume speechSynthesis if paused (Android Chrome bug)
                if (speechSynthesis.paused) {
                    speechSynthesis.resume();
                }

                const utterance = new SpeechSynthesisUtterance('');
                utterance.volume = 0;
                utterance.rate = 1;
                speechSynthesis.speak(utterance);
                speechUnlocked = true;
                console.log('Speech unlocked for mobile');
            } catch (e) {
                console.log('Speech unlock failed:', e);
            }
        }

        // Add speech unlock to touch events
        ['touchstart', 'touchend', 'click', 'mousedown'].forEach(event => {
            document.addEventListener(event, unlockSpeech, { once: false, passive: true });
        });

        // Speak Word with mobile support (iOS + Android)
        function speak(text) {
            if (!('speechSynthesis' in window)) {
                console.log('Speech synthesis not supported');
                return;
            }

            try {
                // Android Chrome bug: speechSynthesis can get stuck
                // Cancel and resume to fix it
                speechSynthesis.cancel();

                if (speechSynthesis.paused) {
                    speechSynthesis.resume();
                }

                // Reload voices if not loaded yet
                if (availableVoices.length === 0) {
                    availableVoices = speechSynthesis.getVoices();
                }

                // Create utterance
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 1;

                // Try to get English voice
                if (availableVoices.length > 0) {
                    const englishVoice = availableVoices.find(v =>
                        v.lang === 'en-US' || v.lang === 'en_US'
                    ) || availableVoices.find(v =>
                        v.lang.startsWith('en')
                    );
                    if (englishVoice) {
                        utterance.voice = englishVoice;
                    }
                }

                // Error handler
                utterance.onerror = (e) => {
                    console.log('Speech error:', e.error);
                };

                utterance.onend = () => {
                    console.log('Speech ended successfully');
                };

                // Speak with a small delay for Android compatibility
                setTimeout(() => {
                    // Double check it's not paused
                    if (speechSynthesis.paused) {
                        speechSynthesis.resume();
                    }
                    speechSynthesis.speak(utterance);
                }, 100);

            } catch (e) {
                console.log('Speak error:', e);
            }
        }

        function speakCurrentWord() {
            if (gameWords.length > 0 && currentQuestionIndex < gameWords.length) {
                speak(gameWords[currentQuestionIndex].english);
            }
        }

        // Save/Load
        function saveWords() {
            localStorage.setItem('vocabWords', JSON.stringify(words));
        }

        function saveStats() {
            localStorage.setItem('totalScore', totalScore);
            localStorage.setItem('totalCorrect', totalCorrect);
        }

        // Update Word List UI
        function updateWordList() {
            const list = document.getElementById('wordList');
            const countSpan = document.getElementById('wordCount');

            if (countSpan) {
                countSpan.textContent = words.length > 0 ? `(${words.length} t·ª´)` : '';
            }

            if (words.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üìñ</div>
                        <p>Ch∆∞a c√≥ t·ª´ n√†o. H√£y th√™m t·ª´ m·ªõi ho·∫∑c b·∫•m "Th√™m t·ª´ m·∫´u" ·ªü tr√™n!</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = words.map((word, index) => `
                <div class="word-item">
                    <div class="word-info">
                        <span class="english-word">${word.english}</span>
                        <span class="meaning">‚Üí ${word.meaning}</span>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="speak-btn" onclick="playSpeakSound(); speak('${word.english.replace(/'/g, "\\'")}')" title="Nghe ph√°t √¢m">üîä</button>
                        <button class="btn btn-danger" onclick="deleteWord(${index})" title="X√≥a t·ª´ n√†y">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // Update Stats
        function updateStats() {
            document.getElementById('totalWords').textContent = words.length;
            document.getElementById('totalCorrect').textContent = totalCorrect;
            document.getElementById('totalScore').textContent = totalScore;
        }

        // Game Mode Selection
        function selectMode(mode) {
            gameMode = mode;
            document.querySelectorAll('.mode-card').forEach(card => card.classList.remove('selected'));
            document.getElementById('mode-' + mode).classList.add('selected');
        }

        // Reset Game UI
        function resetGameUI() {
            document.querySelector('.game-modes').parentElement.style.display = 'block';
            document.getElementById('gamePlayArea').style.display = 'none';
            document.getElementById('resultArea').style.display = 'none';
        }

        // Start Game
        function startGame() {
            if (words.length < 4) {
                alert('B·∫°n c·∫ßn √≠t nh·∫•t 4 t·ª´ ƒë·ªÉ ch∆°i game!');
                return;
            }

            gameWords = [...words].sort(() => Math.random() - 0.5).slice(0, Math.min(10, words.length));
            currentQuestionIndex = 0;
            correctAnswers = 0;

            document.querySelector('.game-modes').parentElement.style.display = 'none';
            document.getElementById('gamePlayArea').style.display = 'block';
            document.getElementById('resultArea').style.display = 'none';

            showQuestion();
        }

        // Show Question
        function showQuestion() {
            const progress = ((currentQuestionIndex) / gameWords.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            const currentWord = gameWords[currentQuestionIndex];
            const answersGrid = document.getElementById('answersGrid');
            const typingArea = document.getElementById('typingArea');
            const speakBtn = document.getElementById('speakBtn');

            if (gameMode === 'meaning') {
                document.getElementById('questionLabel').textContent = 'T·ª´ ti·∫øng Anh:';
                document.getElementById('questionWord').textContent = currentWord.english;
                speakBtn.style.display = 'inline-block';
                answersGrid.style.display = 'grid';
                typingArea.style.display = 'none';

                // Generate answers for multiple choice
                const answers = generateAnswers(currentWord);
                answersGrid.innerHTML = answers.map((answer, index) => `
                    <button class="answer-btn" onclick="checkAnswer(${index}, '${answer.replace(/'/g, "\\'")}')">${answer}</button>
                `).join('');

            } else if (gameMode === 'word') {
                document.getElementById('questionLabel').textContent = 'Nghƒ©a ti·∫øng Vi·ªát:';
                document.getElementById('questionWord').textContent = currentWord.meaning;
                speakBtn.style.display = 'none';
                answersGrid.style.display = 'grid';
                typingArea.style.display = 'none';

                // Generate answers for multiple choice
                const answers = generateAnswers(currentWord);
                answersGrid.innerHTML = answers.map((answer, index) => `
                    <button class="answer-btn" onclick="checkAnswer(${index}, '${answer.replace(/'/g, "\\'")}')">${answer}</button>
                `).join('');

            } else if (gameMode === 'typing') {
                document.getElementById('questionLabel').textContent = 'Nghƒ©a ti·∫øng Vi·ªát:';
                document.getElementById('questionWord').textContent = currentWord.meaning;
                speakBtn.style.display = 'none';
                answersGrid.style.display = 'none';
                typingArea.style.display = 'block';

                // Reset typing input
                const typingInput = document.getElementById('typingInput');
                typingInput.value = '';
                typingInput.className = 'typing-input';
                typingInput.disabled = false;
                typingInput.focus();

                document.getElementById('typingFeedback').textContent = '';
                document.getElementById('typingFeedback').className = 'typing-feedback';
                document.getElementById('typingHint').innerHTML = `
                    <button class="hint-btn" onclick="showHint()">üí° G·ª£i √Ω</button>
                `;
                document.getElementById('submitTypingBtn').disabled = false;
            }
        }

        // Check Typing Answer
        function checkTypingAnswer() {
            const currentWord = gameWords[currentQuestionIndex];
            const typingInput = document.getElementById('typingInput');
            const feedback = document.getElementById('typingFeedback');
            const userAnswer = typingInput.value.trim().toLowerCase();
            const correctAnswer = currentWord.english.toLowerCase();

            typingInput.disabled = true;
            document.getElementById('submitTypingBtn').disabled = true;

            if (userAnswer === correctAnswer) {
                typingInput.className = 'typing-input correct';
                feedback.textContent = '‚úì Ch√≠nh x√°c! Tuy·ªát v·ªùi!';
                feedback.className = 'typing-feedback correct';
                correctAnswers++;
                totalCorrect++;
                totalScore += 15; // More points for typing
                saveStats();
                updateStats();

                playCorrectSound();
                setTimeout(() => speak(currentWord.english), 300);

                document.getElementById('typingHint').innerHTML = '';
            } else {
                typingInput.className = 'typing-input wrong';
                feedback.innerHTML = `‚úó Sai r·ªìi! ƒê√°p √°n ƒë√∫ng l√†: <strong>${currentWord.english}</strong>`;
                feedback.className = 'typing-feedback wrong';

                playWrongSound();
                document.getElementById('typingHint').innerHTML = '';
            }

            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < gameWords.length) {
                    showQuestion();
                } else {
                    showResult();
                }
            }, 2000);
        }

        // Show Hint
        function showHint() {
            const currentWord = gameWords[currentQuestionIndex];
            const english = currentWord.english;
            const hintLength = Math.ceil(english.length / 2);
            const hint = english.substring(0, hintLength) + '_'.repeat(english.length - hintLength);

            playClickSound();
            document.getElementById('typingHint').innerHTML = `
                <div class="hint-text">üí° G·ª£i √Ω: ${hint} (${english.length} ch·ªØ c√°i)</div>
            `;
        }

        // Generate Answers
        function generateAnswers(correctWord) {
            const correct = gameMode === 'meaning' ? correctWord.meaning : correctWord.english;
            const others = words
                .filter(w => w !== correctWord)
                .map(w => gameMode === 'meaning' ? w.meaning : w.english)
                .sort(() => Math.random() - 0.5)
                .slice(0, 3);

            const answers = [correct, ...others].sort(() => Math.random() - 0.5);
            return answers;
        }

        // Check Answer
        function checkAnswer(index, answer) {
            const buttons = document.querySelectorAll('.answer-btn');
            const currentWord = gameWords[currentQuestionIndex];
            const correctAnswer = gameMode === 'meaning' ? currentWord.meaning : currentWord.english;

            buttons.forEach(btn => btn.disabled = true);

            if (answer === correctAnswer) {
                buttons[index].classList.add('correct');
                correctAnswers++;
                totalCorrect++;
                totalScore += 10;
                saveStats();
                updateStats();

                // Play correct sound and speak the English word
                playCorrectSound();
                setTimeout(() => speak(currentWord.english), 300);
            } else {
                buttons[index].classList.add('wrong');
                buttons.forEach(btn => {
                    if (btn.textContent === correctAnswer) {
                        btn.classList.add('correct');
                    }
                });
                // Play wrong sound
                playWrongSound();
            }

            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < gameWords.length) {
                    showQuestion();
                } else {
                    showResult();
                }
            }, 1500);
        }

        // Show Result
        function showResult() {
            document.getElementById('gamePlayArea').style.display = 'none';
            document.getElementById('resultArea').style.display = 'block';

            const percentage = (correctAnswers / gameWords.length) * 100;

            let emoji, title, message;
            if (percentage === 100) {
                emoji = 'üèÜ';
                title = 'Ho√†n h·∫£o!';
                message = 'B·∫°n l√† thi√™n t√†i! Ti·∫øp t·ª•c ph√°t huy nh√©!';
            } else if (percentage >= 80) {
                emoji = 'üéâ';
                title = 'Xu·∫•t s·∫Øc!';
                message = 'B·∫°n ƒë√£ l√†m r·∫•t t·ªët! C·ªë g·∫Øng th√™m ch√∫t n·ªØa!';
            } else if (percentage >= 60) {
                emoji = 'üòä';
                title = 'Kh√° t·ªët!';
                message = 'Ti·∫øp t·ª•c luy·ªán t·∫≠p ƒë·ªÉ c·∫£i thi·ªán nh√©!';
            } else if (percentage >= 40) {
                emoji = 'üí™';
                title = 'C·ªë g·∫Øng l√™n!';
                message = '√în l·∫°i t·ª´ v·ª±ng v√† th·ª≠ l·∫°i nh√©!';
            } else {
                emoji = 'üìö';
                title = 'C·∫ßn √¥n t·∫≠p!';
                message = 'H√£y h·ªçc l·∫°i c√°c t·ª´ v√† th·ª≠ l·∫°i!';
            }

            document.getElementById('resultEmoji').textContent = emoji;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultScore').textContent = `${correctAnswers}/${gameWords.length}`;
            document.getElementById('resultMessage').textContent = message;

            // Play completion sound based on score
            if (percentage === 100) {
                playPerfectSound();
            } else {
                playCompletionSound();
            }
        }

        // Restart Game
        function restartGame() {
            resetGameUI();
        }
    </script>
</body>

</html>